@model ProductListViewModel


@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="payment-content">
    <div class="payment-adress">
        <div class="payment-topbar box"><i class="fa-solid fa-location-dot" style="font-size: 1.5rem;"></i> <strong>Adress</strong></div>
        <div class="payment-acc-content box" style="
    width: 100%;
    display: flex;
    flex-direction: row;
    gap: 1rem;

overflow-x:auto;
    padding: 1rem;
">

            @foreach (var item in Model.addresses)
            {
                <label class="adress-box box @(item.IsDefaultBilling ? "selected" : "not-selected")"
                       onclick="handleAddressSelection(this)"
                       style="display: flex;
                     min-width:100%; height:13rem; margin-top:2rem;
                       flex-direction:row;
justify-content:space-between;
                      gap: 1rem;
                      cursor: pointer;
                      border: 1px solid #ccc;
                      padding: 1rem;
                      border-radius: 8px;">


                    <i class="fa-solid fa-location-dot" style="font-size: 2rem;"></i>



                    <!-- Sağ kısım: Adres Bilgileri -->
                    <div style="display: flex; flex-direction: column; align-items: start; width:100%;">
                        <strong>@item.AddressTitle</strong>
                        <span>@item.City, @item.State</span>
                        <span>@item.Neighbourhood, @item.Street</span>
                    </div>

                </label>
            }
        </div>


    </div>
    <div class="payment-ccard">
        <div class="payment-topbar box"><i class="fa-solid fa-credit-card" style="font-size: 1.5rem;"></i><strong>Credit Card</strong> </div>
        <div class="payment-acc-content box" style="width:100%; justify-content:center; align-items:center;">
            @if (Model.CreditCard != null)
            {
                <div class="flip-card" style="width:25rem; margin:2rem; height:15rem;">
                    <div class="flip-card-inner">
                        <div class="flip-card-front" style="width:100%;">
                            <p class="heading_8264" style="margin:0 0 0 -2rem !important;">MASTERCARD</p>
                            <svg class="logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" width="40" height="40" viewBox="0 0 48 48">
                                <path fill="#ff9800" d="M32 10A14 14 0 1 0 32 38A14 14 0 1 0 32 10Z"></path>
                                <path fill="#d50000" d="M16 10A14 14 0 1 0 16 38A14 14 0 1 0 16 10Z"></path>
                                <path fill="#ff3d00" d="M18,24c0,4.755,2.376,8.95,6,11.48c3.624-2.53,6-6.725,6-11.48s-2.376-8.95-6-11.48 C20.376,15.05,18,19.245,18,24z"></path>
                            </svg>
                            <svg version="1.1" class="chip" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="50px" viewBox="0 0 50 50" xml:space="preserve">  <image id="image0" width="40" height="40" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
              AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB6VBMVEUAAACNcTiVeUKVeUOY
              fEaafEeUeUSYfEWZfEaykleyklaXe0SWekSZZjOYfEWYe0WXfUWXe0WcgEicfkiXe0SVekSXekSW
              ekKYe0a9nF67m12ZfUWUeEaXfESVekOdgEmVeUWWekSniU+VeUKVeUOrjFKYfEWliE6WeESZe0GS
              e0WYfES7ml2Xe0WXeESUeEOWfEWcf0eWfESXe0SXfEWYekSVeUKXfEWxklawkVaZfEWWekOUekOW
              ekSYfESZe0eXekWYfEWZe0WZe0eVeUSWeETAnmDCoWLJpmbxy4P1zoXwyoLIpWbjvXjivnjgu3bf
              u3beunWvkFWxkle/nmDivXiWekTnwXvkwHrCoWOuj1SXe0TEo2TDo2PlwHratnKZfEbQrWvPrWua
              fUfbt3PJp2agg0v0zYX0zYSfgkvKp2frxX7mwHrlv3rsxn/yzIPgvHfduXWXe0XuyIDzzISsjVO1
              lVm0lFitjVPzzIPqxX7duna0lVncuHTLqGjvyIHeuXXxyYGZfUayk1iyk1e2lln1zYTEomO2llrb
              tnOafkjFpGSbfkfZtXLhvHfkv3nqxH3mwXujhU3KqWizlFilh06khk2fgkqsjlPHpWXJp2erjVOh
              g0yWe0SliE+XekShhEvAn2D///+gx8TWAAAARnRSTlMACVCTtsRl7Pv7+vxkBab7pZv5+ZlL/UnU
              /f3SJCVe+Fx39naA9/75XSMh0/3SSkia+pil/KRj7Pr662JPkrbP7OLQ0JFOijI1MwAAAAFiS0dE
              orDd34wAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfnAg0IDx2lsiuJAAACLElEQVRIx2Ng
              GAXkAUYmZhZWPICFmYkRVQcbOwenmzse4MbFzc6DpIGXj8PD04sA8PbhF+CFaxEU8iWkAQT8hEVg
              OkTF/InR4eUVICYO1SIhCRMLDAoKDvFDVhUaEhwUFAjjSUlDdMiEhcOEItzdI6OiYxA6YqODIt3d
              I2DcuDBZsBY5eVTr4xMSYcyk5BRUOXkFsBZFJTQnp6alQxgZmVloUkrKYC0qqmji2WE5EEZuWB6a
              lKoKdi35YQUQRkFYPpFaCouKIYzi6EDitJSUlsGY5RWVRGjJLyxNy4ZxqtIqqvOxaVELQwZFZdkI
              JVU1RSiSalAt6rUwUBdWG1CP6pT6gNqwOrgCdQyHNYR5YQFhDXj8MiK1IAeyN6aORiyBjByVTc0F
              qBoKWpqwRCVSgilOaY2OaUPw29qjOzqLvTAchpos47u6EZyYnngUSRwpuTe6D+6qaFQdOPNLRzOM
              1dzhRZyW+CZouHk3dWLXglFcFIflQhj9YWjJGlZcaKAVSvjyPrRQ0oQVKDAQHlYFYUwIm4gqExGm
              BSkutaVQJeomwViTJqPK6OhCy2Q9sQBk8cY0DxjTJw0lAQWK6cOKfgNhpKK7ZMpUeF3jPa28BCET
              amiEqJKM+X1gxvWXpoUjVIVPnwErw71nmpgiqiQGBjNzbgs3j1nus+fMndc+Cwm0T52/oNR9lsdC
              S24ra7Tq1cbWjpXV3sHRCb1idXZ0sGdltXNxRateRwHRAACYHutzk/2I5QAAACV0RVh0ZGF0ZTpj
              cmVhdGUAMjAyMy0wMi0xM1QwODoxNToyOSswMDowMEUnN7UAAAAldEVYdGRhdGU6bW9kaWZ5ADIw
              MjMtMDItMTNUMDg6MTU6MjkrMDA6MDA0eo8JAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDIzLTAy
              LTEzVDA4OjE1OjI5KzAwOjAwY2+u1gAAAABJRU5ErkJggg=="></image>
                                </svg>
                            <svg version="1.1" class="contactless" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="30px" height="30px" viewBox="0 0 50 50" xml:space="preserve" style="margin:0 0 0 -2rem !important;">  <image id="image0" width="40" height="40" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAQAAAC0NkA6AAAABGdBTUEAALGPC/xhBQAAACBjSFJN
              AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZ
              cwAACxMAAAsTAQCanBgAAAAHdElNRQfnAg0IEzgIwaKTAAADDklEQVRYw+1XS0iUURQ+f5qPyjQf
              lGRFEEFK76koKGxRbWyVVLSOgsCgwjZBJJYuKogSIoOonUK4q3U0WVBWFPZYiIE6kuArG3VGzK/F
              fPeMM/MLt99/NuHdfPd888/57jn3nvsQWWj/VcMlvMMd5KRTogqx9iCdIjUUmcGR9ImUYowyP3xN
              GQJoRLVaZ2DaZf8kyjEJALhI28ELioyiwC+Rc3QZwRYyO/DH51hQgWm6DMIh10KmD4u9O16K49it
              VoPOAmcGAWWOepXIRScAoJZ2Frro8oN+EyTT6lWkkg6msZfMSR35QTJmjU0g15tIGSJ08ZZMJkJk
              HpNZgSkyXosS13TkJpZ62mPIJvOSzC1bp8vRhhCakEk7G9/o4gmZdbpsTcKu0m63FbnBP9Qrc15z
              bkbemfgNDtEOI8NO5L5O9VYyRYgmJayZ9nPaxZrSjW4+F6Uw9yQqIiIZwhp2huQTf6OIvCZyGM6g
              DJBZbyXifJXr7FZjGXsdxADxI7HUJFB6iWvsIhFpkoiIiGTJfjJfiCuJg2ZEspq9EHGVpYgzKqwJ
              qSAOEwuJQ/pxPvE3cYltJCLdxBLiSKKIE5HxJKcTRNeadxfhDiuYw44zVs1dxKwRk/uCxIiQkxKB
              sSctRVAge9g1E15EHE6yRUaJecRxcWlukdRIbGFOSZCMWQA/iWauIP3slREHXPyliqBcrrD71Amz
              Z+rD1Mt2Yr8TZc/UR4/YtFnbijnHi3UrN9vKQ9rPaJf867ZiaqDB+czeKYmd3pNa6fuI75MiC0uX
              XSR5aEMf7s7a6r/PudVXkjFb/SsrCRfROk0Fx6+H1i9kkTGn/E1vEmt1m089fh+RKdQ5O+xNJPUi
              cUIjO0Dm7HwvErEr0YxeibL1StSh37STafE4I7zcBdRq1DiOkdmlTJVnkQTBTS7X1FYyvfO4piaI
              nKbDCDaT2anLudYXCRFsQBgAcIF2/Okwgvz5+Z4tsw118dzruvIvjhTB+HOuWy8UvovEH6beitBK
              xDyxm9MmISKCWrzB7bSlaqGlsf0FC0gMjzTg6GgAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDIt
              MTNUMDg6MTk6NTYrMDA6MDCjlq7LAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTAyLTEzVDA4OjE5
              OjU2KzAwOjAw0ssWdwAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyMy0wMi0xM1QwODoxOTo1Nisw
              MDowMIXeN6gAAAAASUVORK5CYII="></image>
                                </svg>
                            <p class="number" style="margin:-1.5rem 0 0 0 !important;">@Model.CreditCard.cartNumber</p>
                            <p class="valid_thru" style="margin:-1.5rem 0 0 1rem !important;">VALID<br /> THRU</p>
                            <p class="date_8264" style="margin:-1.5rem 0 0 .4rem !important;">@Model.CreditCard.month / @Model.CreditCard.year</p>
                            <p class="name" style="margin:-1.5rem 0 0 -.3rem !important;">@Model.apUser.Name @Model.apUser.LastName</p>
                        </div>
                        <div class="flip-card-back">
                            <div class="strip"></div>
                            <div class="mstrip"></div>
                            <div class="sstrip">
                                <p class="code">***</p>

                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
    <div class="payment-cartitem">
        <div class="payment-topbar box"><i class="fa-solid fa-bag-shopping" style="font-size: 1.5rem;"></i><strong>Basket</strong></div>
        <div class="payment-acc-content box" style="width:100%; justify-content:center;">
            @{
                decimal totalAmount = 0; // Toplam fiyatı tutacak değişken
            }

            @foreach (var product in Model.cartItems?.Where(p => p.isPaid == false))
            {
                decimal productTotalPrice = product.SelectedPrice * product.SelectedQuantity;
                totalAmount += productTotalPrice;
            

                var cartProduct = Model.Products.FirstOrDefault(p => p.ProductId == product.ProductId);
                var productImage = Model.productImages?
                .FirstOrDefault(img => img.productId == product.ProductId);

                string base64Image = productImage != null
                ? $"data:{productImage.ContentType};base64,{Convert.ToBase64String(productImage.ImageData)}"
                : "~/img/default.png"; // varsayılan resim yolu
                <div class="cart-content" style="width:90%;">
                    <div class="cc-left">

                        <img src="@base64Image" style="max-width: 50px; max-height: 50px;" />
                        <div class="cc-left-text">
                            <small style="font-weight:bold; ">@(cartProduct?.Name ?? "Ürün Bulunamadı")</small><br>
                            <small style=" font-size:10px;">@(cartProduct?.Description ?? "Açıklama Yok")</small><br>
                            <span style="font-weight:bold; font-size:8px;">Option : @product.SelectedValue</span>
                            <span style="font-weight:bold; font-size:8px;">Adet : @product.SelectedQuantity</span>
                        </div>
                    </div>

          

                    <div class="cc-right">
                        <form method="post" asp-controller="Cart" asp-action="RemoveFromCart">
                            <input type="hidden" name="cartItemId" value="@product.CartItemId" />
                            <button type="submit" class="btn btn-danger">
                                <i class='fa-solid fa-trash'></i>
                            </button>
                        </form>
                    </div>
                </div>
            }

            <br />
            <div class="total-amount">
                <h5>Toplam Tutar: @totalAmount.ToString("F0") ₺</h5> <!-- Tüm ürünlerin toplam fiyatını göster -->
            </div>
            <br />
            <form method="post" id="orderForm" asp-action="addOrder" asp-controller="Payment">
                <input type="hidden" name="userId" value="@Model.apUser.ApplicationUserId" />
                @foreach (var item in Model.cartItems)
                {
                    <input type="hidden" name="CartItemId" value="@item.CartItemId" />
                }
                <input type="hidden" name="isPaid" value="true" />
                <button id="addOrderBtn" type="submit" class="btn btn-primary"> <i class="fa-solid fa-money-check-dollar"></i> Ödemeyi Tamamla </button>
            </form>
        </div>
    </div>
</div>


<script>

    document.getElementById("addOrderBtn").addEventListener("click", function (e) {
        e.preventDefault(); // Sayfanın reload olmasını engelle

        const form = this.closest("form"); // En yakın formu bul

        confirmDialog(
            "Ödemeyi Tamamlamak Üzeresiniz.",
            "Siparişi Tamamlayın.  Devam etmek istiyor musunuz?",
            function () {
                form.submit(); // Onay verildiyse formu gönder
                showToastAndSave('Siparişiniz Başarılı bir şekilde oluşturuldu.', 'success');
            },
            function () {
                console.log("işlem iptal edildi.");
            }
        );
    });


    function handleCheckboxChange(selectedCheckbox) {
        // Tüm checkboxları seç
        let checkboxes = document.querySelectorAll(".billing-checkbox");

        // Seçilen checkbox dışındaki diğerlerini devre dışı bırak
        checkboxes.forEach(checkbox => {
            if (checkbox !== selectedCheckbox) {
                checkbox.checked = false;
            }
        });
    }
</script>